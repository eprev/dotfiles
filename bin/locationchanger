#!/bin/bash

# Automatically change configuration of Mac OS X based on the location.

# exec 1>/dev/null 2>/dev/null

sleep 3

SSID=`/System/Library/PrivateFrameworks/Apple80211.framework/Versions/A/Resources/airport -I | grep ' SSID:' | cut -d ':' -f 2 | tr -d ' '`

LOCATION_NAMES=`scselect | tail -n +2 | cut -d "(" -f 2 | cut -d ")" -f 1`
CURRENT_LOCATION=`scselect | grep " \* " | cut -d "(" -f 2 | cut -d ")" -f 1`

if echo "$LOCATION_NAMES" | egrep -q "^$SSID$"; then
    NEW_LOCATION="$SSID"
else
    if echo Automatic | grep -q "$LOCATION_NAMES"; then
        NEW_LOCATION=Automatic
    else
        echo "Automatic location was not found!"
        echo "The following locations are known: $LOCATION_NAMES"
    fi
fi

if [ "x$NEW_LOCATION" != "x" -a "x$NEW_LOCATION" != "x$CURRENT_LOCATION" ]; then
    echo "Changing to $NEW_LOCATION"
    scselect "$NEW_LOCATION"
    SCRIPT="$HOME/.dotfiles/locations/$NEW_LOCATION"
    if [ -f $SCRIPT ]; then
        $SCRIPT
    fi
fi
